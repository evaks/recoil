<html>
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<title>recoil.ui.widgets.TableWidget</title>
<script src="../../../../../closure-library/closure/goog/base.js"></script>
<script src="../../../../../my-deps.js"></script>

<script>
  goog.require('recoil.frp.Frp');
  goog.require('recoil.ui.widgets.table.TableWidget');
  goog.require('recoil.ui.widgets.ButtonWidget');
  goog.require('recoil.ui.BoolWithExplaination');
  goog.require('recoil.ui.WidgetScope');
</script>

<body>
  <div id='tablediv'/>
  <div id='addB'/>
  <div id='hideB'/>
  <div id='showB'/>
  TODO <br/>all decorators<br/>
  remove rows<br/>
  add in middle<br/>
  cell renderers<br/>
  selection<br/>
  
  <script>
    var scope = new recoil.ui.WidgetScope();
    var frp = scope.getFrp();
    var $ = goog.dom.getElement;

    var rawTable = [
    {id: 1, name: "row 1", count:2, check: true},
    {id: 2, name: "row 2", count:4, check: true},
    {id: 3, name: "row 3", count:6, check: true}];

    var tblKeys = {
    id : new recoil.structs.table.ColumnKey("id_"),
    name : new recoil.structs.table.ColumnKey("name_"),
    count: new recoil.structs.table.ColumnKey("count_"),
    check :  new recoil.structs.table.ColumnKey("check_")
    };

    var rawTableMeta = {
    name : { type : "string", length : 20, key : tblKeys.name},
    id : { type : "int", primary : 0, key : tblKeys.id},
    count : { type: "int", min : 1, max:100, key: tblKeys.count},
    check : { type: "bool", key: tblKeys.check}
    };

    var columns = new recoil.ui.widgets.TableMetaData();
    columns.add(tblKeys.name, "Name");
    columns.add(tblKeys.count, "Count");
    columns.add(tblKeys.check, "Check");
    
    var columnsB = frp.createB(columns);


    var typeFactories = {"int": function(meta) {
        return new recoil.ui.widgets.table.NumberColumn(meta);
    }, "string": function (meta) {
        return new recoil.ui.widgets.table.StringColumn(meta);
    }, "boolean": function (meta) {
        return new recoil.ui.widgets.table.BooleanColumn(meta);
    }};

    var table = frp.createB(recoil.structs.table.Table.create(typeFactories, rawTableMeta, rawTable));
    
    var tableWidget = new recoil.ui.widgets.table.TableWidget(scope);

    console.log('table', $('tablediv'), tableWidget.getComponent().getElement());


    var buttonWidget = new recoil.ui.widgets.ButtonWidget(scope);

    buttonWidget.attach("", "Add Row", frp.createCallback(function () {
    var max = 1;
    table.get().forEach( function(row) {
    max = Math.max(row.get(tblKeys.id), max);
    });

    max ++;
    var mtable = table.get().unfreeze();
    var row = new recoil.structs.table.MutableTableRow();
    row.set(tblKeys.id, max);
    row.set(tblKeys.name, "row "+ max);
    row.set(tblKeys.count, max);
    row.set(tblKeys.check, false);
    
    mtable.addRow(row);
    table.set(mtable.freeze());
    }, table));
    tableWidget.attach(table,columnsB);
    var hideWidget = new recoil.ui.widgets.ButtonWidget(scope);
    var showWidget = new recoil.ui.widgets.ButtonWidget(scope);


    hideWidget.attach("", "Hide", frp.createCallback(function () {
    var columns = new recoil.ui.widgets.TableMetaData();
    columns.add(tblKeys.name, "Name");
    //columns.add(tblKeys.count, "Count");
    columns.add(tblKeys.check, "Check");
    columnsB.set(columns);
    },columnsB));


    showWidget.attach("", "Show", frp.createCallback(function () {
    var columns = new recoil.ui.widgets.TableMetaData();
    columns.add(tblKeys.name, "Name");
    columns.add(tblKeys.count, "Count");
    columns.add(tblKeys.check, "Check");
    columnsB.set(columns);
    },columnsB));

    tableWidget.getComponent().render($('tablediv'));
    buttonWidget.getComponent().render($('addB'));
    hideWidget.getComponent().render($('hideB'));
    showWidget.getComponent().render($('showB'));

    
  </script>

</body>

</html>


